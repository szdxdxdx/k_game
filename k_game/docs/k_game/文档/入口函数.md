
# 入口函数

## 入口函数

本框架中，游戏的入口函数为 `k_game_run()`，你需要在 `main()` 中手动调用该函数。示例代码如下：

```C
/* 此代码不是完整的示例代码，不能直接运行 */

int main(void) {

    /* 游戏相关的配置 */
    struct k_game_config config = ...;

    /* 启动游戏 */
    return k_game_run(&config);
}
```

`k_game_config` 是启动游戏所需的配置参数。因为配置项比较多，所以 k_game 将这些参数打包成一个结构体，
并提供了一个默认值 `K_GAME_CONFIG_INIT`，你只需要填写你关心的那几项配置即可。

> 若 API 的参数太多，k_game 都会将入参打包成一个结构体，并定义一个默认值（通常是一个以 `_INIT` 为后缀的宏）。
> 这是 C 语言中一种经典的 API 向后兼容设计方式。若以后要为 API 新增参数，只需在结构体中新增字段，同时更新默认值宏，旧代码无需改动。
> 同时，该设计也简化了 API 的使用难度，因为调用者只需要填写自己关心的参数，而其他参数可以使用默认值。

详细一点的示例代码如下：

```C
/* 此代码不是完整的示例代码，不能直接运行 */

#include "k_game.h"

int main(void) {
    
    /* 编写游戏相关的配置，K_GAME_CONFIG_INIT 为默认值 */
    struct k_game_config config = K_GAME_CONFIG_INIT;
    config.window_w = ...; /* 游戏窗口的宽高 */
    config.window_h = ...;
    config.window_title = "my game"; /* 游戏窗口的标题 */
    config.on_start = on_game_start; /* 必须指定游戏初始化的回调 */

    return k_game_run(&config); /* 启动游戏 */
}

/* 游戏初始化时执行的回调 */
static int on_game_start(void) {
    ... /* 在此处加载资源（图片、音频等）、创建房间、注册组件类型 */
    
    return 0; /* 返回 0 表示初始化成功，非 0 表示失败 */
}
```

## 环境初始化

执行 `k_game_run()` 时，框架会初始化游戏环境。由于框架底层依赖 SDL2，k_game 会初始化 SDL 环境，因此你不要再手动初始化 SDL，以免引发冲突。

调用 `k_game_run()` 时，你必须指定游戏的初始化回调 `config.on_start`，否则游戏无法启动。
该回调返回 0 表示初始化成功，返回非 0 表示失败。若失败，则游戏无法启动，框架会释放已加载的资源、销毁房间等。

在游戏的初始化回调 `on_start()` 中，你可以执行加载资源（图片、音频等）、创建房间、注册组件类型等操作，这些内容在文档后续的章节中会介绍。

> 本框架中，若回调函数的返回值是 int 类型，大多数是返回一个状态码，0 表示成功，非 0 表示失败。请留心，不要忘记写 `return`。

你不能在启动游戏之前（执行 `on_start()` 回调之前）加载资源、创建房间、注册组件等，因为这些操作依赖 k_game 游戏环境，而此时环境尚未初始化。
你可以在游戏运行过程中动态创建或加载资源，但 k_game 推荐你在游戏初始化阶段就尽可能地完成资源加载。
原因很简单，k_game 是一个小框架，而你的游戏通常不会涉及太多资源，在初始化阶段一次性加载完所有资源是最合适的。
