
# 按键检测

按键检测相关的 API 都声明在 `k_game/core/k_keyboard.h` 和 `k_game/core/k_mouse.h` 头文件中。

框架在游戏循环中，每帧开始时会调用 SDL 提供的接口，获取并记录键盘和鼠标的状态。
之后每次调用框架提供的按键检测的 API，实际都是查询记录，而不是直接访问硬件。

每个按键有“空闲”、“按下”、“按住”和“松开”四种状态，其中“按下”和“松开”是在一帧之内瞬间完成的状态，而“空闲”和“按住”是在持续多帧的状态。

框架使用 ASCII 码作为字母键、符号键的键码。
注意需要修饰符来修改按键的行为才能打出的字符，对应的键码不可用。
例如，k_game 不会直接识别出 `#`，而是识别出 `shift` 和 `3`。

示例代码：
```C
/* 在房间的步事件回调中检测按键是否按下 */
void my_room_on_step(void *data) {
    if (k_key_down('A')) printf("A 键按下\n");
    if (k_key_up('A'))   printf("A 键抬起\n");
    if (k_key_held('A')) printf("A 键按住\n");
}
```

> SDL提供了按键检测功能，能够识别按键是否被按下或抬起，但其处理方式并不适用于游戏。
> 当用户按住按键不放时，SDL 会先捕获到一次“按键按下”的消息，然后经过一小段时间的延迟后，持续捕获到更多的“按键按下”消息，
> 就像用户在重复敲击按键。这是因为 SDL 只是对不同操作系统的按键消息进行了统一的封装，而按键消息本身是由操作系统底层生成的。
> 操作系统的这种“长按”机制，主要是面向文本输入场景而设计的，并不适合直接用于游戏。
> 在游戏中，“长按”意味着该按键相对于上一帧仍处于按下状态。所以本框架不得不封装 SDL 的按键检测，同时框架封装了 SDL 的键码
